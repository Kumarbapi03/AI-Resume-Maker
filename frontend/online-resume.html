<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translation-key="welcome_title">Welcome to Technolize</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Lobster&display=swap" rel="stylesheet">
    
    <style>
        /* --- General & Body Setup --- */
        :root {
            --primary-lightest: #C6E7D8; /* Lightest Green */
            --primary-light: #59DAC7;    /* Light Teal */
            --primary-medium: #4C7F62; /* Medium Green */
            --primary-dark: #486855;    /* Darker Green */
            --secondary-dark: #0D4540; /* Very Dark Teal */
            --secondary-darkest: #05393B; /* Deepest Green-Blue */
            --border-light: #b0d9c8; /* A slightly darker light green for borders */
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--primary-lightest);
            color: var(--secondary-darkest);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* --- START: CSS FOR TOP BAR --- */
        .top-bar {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem 2.5rem; 
            position: relative;
            z-index: 100;
            flex-shrink: 0;
        }

        .logo {
            font-family: 'Lobster', cursive;
            font-size: 1.9rem;
            font-weight: 400;
            color: var(--secondary-darkest);
        }
        
        .language-switcher {
            position: relative;
        }

        .language-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 8px 12px;
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            font-weight: 500;
            background-color: #fcfcfc;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        /* NEW: Added a button for offline mode */
        .mode-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            border: 1px solid var(--primary-dark);
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 0.9rem;
            font-weight: 600;
            background-color: var(--primary-dark);
            color: white;
            cursor: pointer;
            margin-right: 15px; /* Spacing from language selector */
            transition: all 0.2s ease;
        }
        
        .mode-btn:hover {
            background-color: var(--primary-medium);
            border-color: var(--primary-medium);
        }

        .language-btn:hover,
        .language-btn:focus {
            outline: none;
            border-color: var(--primary-dark);
            box-shadow: 0 0 0 3px rgba(72, 104, 85, 0.1);
        }

        .language-dropdown {
            display: none; 
            position: absolute;
            top: 110%;
            right: 0;
            min-width: 220px;
            background-color: #ffffff;
            border-radius: 12px;
            border: 1px solid #eee;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
            max-height: 300px;
            overflow-y: auto;
            z-index: 110;
        }

        .language-dropdown.show {
            display: block;
        }

        .language-option {
            display: block;
            padding: 10px 16px;
            font-size: 0.95rem;
            color: #333;
            text-decoration: none;
            cursor: pointer;
        }

        .language-option:hover {
            background-color: #f5f5f9;
        }
        
        .language-option.selected {
            font-weight: 600;
            color: var(--primary-dark);
            background-color: #f0f4f2;
        }
        /* --- END: CSS FOR TOP BAR --- */


        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 2rem 2rem;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 85px);
        }

        /* --- 1. Header Section --- */
        .header-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            margin-bottom: 2rem; 
            transition: all 0.3s ease; 
        }
        
        .header-content.hidden {
            display: none;
        }


        .ai-tag {
            background-color: #ffffff;
            color: var(--primary-medium);
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-bottom: 1rem;
        }

        .header-content h1 {
            font-size: 3rem;
            font-weight: 700;
            color: var(--secondary-darkest);
            margin-bottom: 0.5rem;
        }

        .subtitle {
            font-size: 1.1rem;
            color: var(--primary-dark);
            max-width: 600px;
            line-height: 1.6;
            margin-bottom: 2rem;
        }

        /* CRITICAL CSS FIX */
        .create-goal-btn {
            background-color: var(--primary-dark);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            font-size: 1rem;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
            cursor: pointer;
            display: inline-flex; /* <--- FIX: Makes the button shrink-wrap to its content width */
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 14px rgba(72, 104, 85, 0.25);
            transition: all 0.3s ease;
        }
        
        .create-goal-btn:disabled {
            background-color: #aaa;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .create-goal-btn:hover {
            background-color: var(--primary-medium);
            box-shadow: 0 6px 16px rgba(72, 104, 85, 0.3);
            transform: translateY(-2px);
        }
        
        .create-goal-btn:disabled:hover {
            background-color: #aaa;
            box-shadow: 0 4px 14px rgba(72, 104, 85, 0.25);
            transform: none;
        }


        /* --- 2. Chat Display Area --- */
        .chat-display-area {
            display: none; /* Hidden by default */
            flex-direction: column;
            gap: 10px;
            width: 100%;
            flex-grow: 1;
            overflow-y: auto;
            background: #ffffff; 
            border: 1px solid var(--border-light); 
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        .chat-display-area.visible {
            display: flex;
        }

        .chat-message {
            padding: 10px 16px;
            border-radius: 18px;
            max-width: 80%;
            line-height: 1.5;
            font-size: 0.95rem;
            animation: fadeIn 0.3s ease-out; 
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .bot-message {
            background-color: #f0f4f2; 
            color: var(--secondary-darkest); 
            align-self: flex-start;
            display: flex; 
            align-items: center; 
            gap: 10px; 
        }

        .bot-icon {
            width: 28px;
            height: 28px;
            flex-shrink: 0;
            background: var(--primary-dark);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem; 
        }
        
        .bot-icon svg {
             width: 16px;
             height: 16px;
             fill: white;
        }

        .bot-message-text {
            flex-grow: 1;
        }

        .user-message {
            background-color: var(--primary-dark); 
            color: white;
            align-self: flex-end;
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-icon {
            width: 28px;
            height: 28px;
            flex-shrink: 0;
            background: var(--primary-lightest);
            border: 1px solid var(--primary-dark);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-dark);
            font-size: 0.8rem;
            order: 2;
        }
        
        .user-icon svg {
             width: 16px;
             height: 16px;
             stroke: var(--primary-dark);
             fill: none;
        }

        .user-message-text {
            flex-grow: 1;
            order: 1;
        }

        /* --- Styles for typing indicator --- */
        .typing-indicator {
            padding: 10px 16px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .typing-indicator .dot {
            width: 8px;
            height: 8px;
            background-color: #aaa;
            border-radius: 50%;
            animation: pulse 1.2s infinite ease-in-out;
        }
        .typing-indicator .dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator .dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes pulse {
            0%, 80%, 100% { transform: scale(0.6); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        /* --- START: CSS FOR OPTIONS --- */
        .options-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-self: flex-start;
            width: 100%;
            padding: 10px 0 5px 40px;
            animation: fadeIn 0.3s ease-out;
        }
        
        .option-btn {
            background-color: #ffffff;
            border: 1px solid var(--border-light);
            color: var(--primary-dark);
            padding: 8px 14px;
            border-radius: 16px;
            font-size: 0.9rem;
            font-weight: 500;
            font-family: 'Inter', sans-serif;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .option-btn:hover {
            background-color: #f0f4f2;
            border-color: var(--primary-medium);
        }
        
        .option-btn.selected {
            background-color: var(--primary-dark);
            color: white;
            border-color: var(--primary-dark);
        }
        
        .option-btn.done-btn {
            background-color: var(--secondary-darkest);
            color: white;
            font-weight: 600;
        }
        /* --- END: CSS FOR OPTIONS --- */


        /* --- 3. AI Input Section --- */
        .ai-input-container {
            width: 100%;
            border-radius: 28px; 
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--border-light); 
            overflow: hidden;
            background: #ffffff; 
            flex-shrink: 0;
            margin-top: 1rem;
        }

        .ai-input-box {
            background-color: transparent; 
            padding: 0.5rem 0.75rem; 
            display: flex;
            flex-direction: row; 
            gap: 0.5rem; 
            align-items: center; 
        }

        input#goal-input {
            border: none;
            outline: none;
            background: transparent;
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            color: #333; 
            width: 100%;
            line-height: 1.6;
            padding: 0.5rem; 
            flex-grow: 1; 
            transition: opacity 0.2s ease;
        }

        input#goal-input:disabled {
            background-color: #f9f9f9;
            opacity: 0.7;
            cursor: not-allowed;
        }


        input#goal-input::placeholder {
            color: #aaa; 
            font-weight: 500;
        }

        .icon-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px; 
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }

        .icon-btn:hover {
            background-color: #f0f0f0; 
        }
        
        .icon-btn svg {
            stroke: #666; 
        }
        
        /* CSS FOR LISTENING STATE */
        .icon-btn#mic-btn.listening svg {
            stroke: #D93025;
            animation: pulse-mic 1.5s infinite ease-in-out;
        }
        
        @keyframes pulse-mic {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        
        .send-btn {
            background-color: var(--secondary-darkest); 
            color: white;
            border: none;
            width: 38px; 
            height: 38px; 
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            flex-shrink: 0; 
        }
        
        .send-btn:hover {
            background-color: var(--primary-dark); 
        }
        
        .send-btn:disabled {
            background-color: #aaa;
            cursor: not-allowed;
        }
        
        .send-btn svg {
            stroke: white;
        }


        /* --- Custom Alert Modal --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }
        .modal-box {
            background: white;
            padding: 1.5rem 2rem;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            max-width: 400px;
            width: 100%;
            text-align: center;
        }
        .modal-box p {
            font-size: 1rem;
            color: #333;
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }
        .modal-close-btn {
            background-color: var(--primary-dark); 
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 18px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .modal-close-btn:hover {
            background-color: var(--primary-medium); 
        }
    </style>
</head>
<body>

    <nav class="top-bar">
        <div class="logo" data-translation-key="app_name">Resume Maker</div>
        
        <div style="display: flex; align-items: center;">
            <button class="mode-btn" id="offline-mode-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                </svg>
                <span data-translation-key="offline_mode_label">Offline Builder</span>
            </button>
            
            <div class="language-switcher">
                <button class="language-btn" id="language-toggle-btn" aria-haspopup="true" aria-expanded="false">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="2" y1="12" x2="22" y2="12"></line>
                        <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                    </svg>
                    <span id="current-lang-text">English</span>
                </button>
                
                <div class="language-dropdown" id="language-dropdown-menu" role="menu">
                    <a href="#" class="language-option selected" role="menuitem" data-lang="en" data-display-text="English">English</a>
                    <a href="#" class="language-option" role="menuitem" data-lang="hi" data-display-text="हिन्दी">हिन्दी (Hindi)</a>
                    <a href="#" class="language-option" role="menuitem" data-lang="bn" data-display-text="বাংলা">বাংলা (Bengali)</a>
                    <a href="#" class="language-option" role="menuitem" data-lang="te" data-display-text="తెలుగు">తెలుగు (Telugu)</a>
                    <a href="#" class="language-option" role="menuitem" data-lang="mr" data-display-text="మరాఠీ">मराठी (Marathi)</a>
                    <a href="#" class="language-option" role="menuitem" data-lang="ta" data-display-text="தமிழ்">தமிழ் (Tamil)</a>
                    <a href="#" class="language-option" role="menuitem" data-lang="ur" data-display-text="اردো">اردো (Urdu)</a>
                    <a href="#" class="language-option" role="menuitem" data-lang="gu" data-display-text="ગુજરાતી">ગુજરાતી (Gujarati)</a>
                    <a href="#" class="language-option" role="menuitem" data-lang="kn" data-display-text="ಕನ್ನಡ">ಕನ್ನಡ (Kannada)</a>
                    <a href="#" class="language-option" role="menuitem" data-lang="ml" data-display-text="മലയാളം">മലയാളം (Malayalam)</a>
                    <a href="#" class="language-option" role="menuitem" data-lang="pa" data-display-text="ਪੰਜਾਬੀ">ਪੰਜਾਬੀ (Punjabi)</a>
                    <a href="#" class="language-option" role="menuitem" data-lang="or" data-display-text="ଓଡ଼ିଆ">ଓଡ଼ିଆ (Odia)</a>
                    <a href="#" class="language-option" role="menuitem" data-lang="as" data-display-text="অসমীয়া">অসমীয়া (Assamese)</a>
                    <a href="#" class="language-option" role="menuitem" data-lang="mai" data-display-text="मैथिली">मैथिली (Maithili)</a>
                    <a href="#" class="language-option" role="menuitem" data-lang="sat" data-display-text="সংताली">সংताली (Santali)</a>
                    <a href="#" class="language-option" role="menuitem" data-lang="ks" data-display-text="कश्मीरी">कश्मीरी (Kashmiri)</a>
                    <a href="#" class="language-option" role="menuitem" data-lang="ne" data-display-text="नेपाली">नेपाली (Nepali)</a>
                    <a href="#" class="language-option" role="menuitem" data-lang="sd" data-display-text="सिन्धी">सिन्धी (Sindhi)</a>
                    <a href="#" class="language-option" role="menuitem" data-lang="kok" data-display-text="कोंकणी">कोंकणी (Konkani)</a>
                    <a href="#" class="language-option" role="menuitem" data-lang="doi" data-display-text="डोगरी">डोगरी (Dogri)</a>
                    <a href="#" class="language-option" role="menuitem" data-lang="mni" data-display-text="মৈতৈলোন্">মৈতৈলোন্ (Manipuri)</a>
                </div>
            </div>
        </div>
    </nav>
    <main class="container">
        <header class="header-content" id="header-content">
            <span class="ai-tag" data-translation-key="ai_tag">AI-powered efficiency</span>
            <h1 data-translation-key="welcome_title">Welcome to Technolize</h1>
            <p class="subtitle" data-translation-key="subtitle">
                Build your professional resume with AI-powered efficiency, ensuring smarter formatting and streamlined success.
            </p>

            <button class="create-goal-btn" id="create-goal-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                <span id="create-goal-btn-text" data-translation-key="lets_make">Let's Make</span>
            </button>

        </header>

        <section class="chat-display-area" id="chat-display"></section>

        <section class="ai-input-container">
            <div class="ai-input-box">
                <button class="icon-btn" id="tts-btn" 
                    aria-label="Read text aloud (Disabled - Requires AI/Browser API)"
                    data-translation-key="alert_tts" 
                    data-translation-attr="aria-label"
                    disabled> 
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                    </svg>
                </button>
                
                <input type="text" id="goal-input" 
                    placeholder="Please wait..." 
                    data-translation-key="type_answer"
                    data-translation-attr="placeholder"
                    disabled>

                <button class="icon-btn" id="mic-btn" 
                    aria-label="Use microphone (Disabled - Requires AI/Browser API)"
                    data-translation-key="alert_voice"
                    data-translation-attr="aria-label"
                    disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                        <line x1="12" y1="19" x2="12" y2="22"></line>
                    </svg>
                </button>
                
                <button class="send-btn" 
                    aria-label="Generate"
                    data-translation-key="next"
                    data-translation-attr="aria-label"
                    disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="12" y1="19" x2="12" y2="5"></line>
                        <polyline points="5 12 12 5 19 12"></polyline>
                    </svg>
                </button>
            </div>
        </section>

    </main>

    <div class="modal-overlay" id="custom-alert-overlay">
        <div class="modal-box">
            <p id="custom-alert-message">This is an alert message.</p>
            <button class="modal-close-btn" id="custom-alert-close" data-translation-key="next">OK</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- LOCAL DATA STRUCTURES (Simulating the removed backend) ---
            const localTranslations = {
                "welcome_title": "Welcome to Technolize",
                "app_name": "Resume Builder",
                "ai_tag": "AI-powered efficiency",
                "subtitle": "Build your professional resume with AI-powered efficiency, ensuring smarter formatting and streamlined success.",
                "lets_make": "Start Building",
                "offline_mode_label": "Offline Builder",
                "type_answer": "Type your answer...",
                "select_profession": "Please select an option or type your answer...",
                "next": "Next",
                "ok": "OK",
                "alert_required": "Please type an answer to continue.",
                "alert_lang_change": "Language set to",
                "alert_switch_offline": "Switching to Offline Builder. All AI features are disabled.",
                "welcome_message": "Hello! I'm your AI resume assistant.",
                "select_profession_prompt": "To start, please choose your profession from the list below.",
                "profession_selected": "Great! You selected {profession}.",
                "resume_complete": "All done! Sending your data to the AI for resume generation...",
                "resume_success": "Success! Your resume is ready. Redirecting to your dashboard...",
                "resume_fail": "Generation failed! Please try again or check your network connection.",
                "question_fetch_fail": "Could not load questions. Please refresh and try again.",
                "none": "None",
                "professions": {
                    "cook": "Cook / Chef", "electrical": "Electrician", "plumbing": "Plumber",
                    "driver": "Driver", "carpentry": "Carpenter", "welding": "Welder",
                    "masonry": "Mason / Bricklayer", "painting": "Painter", "mechanic": "Auto Mechanic",
                    "factory": "Factory Worker", "farm": "Farm Worker", "security": "Security Guard",
                    "cleaning": "Cleaner / Maid", "tailor": "Tailor / Seamstress", "construction": "Construction Worker",
                    "automotive": "Automotive Technician", "general": "General Laborer"
                },
                "questions": {
                    "name": "What is your full legal name?",
                    "contact": "What is your best contact number and email?",
                    "experience_years": "How many years of experience do you have in this profession?",
                    "key_skills": "Which key skills do you possess? (Select all that apply)",
                    "job_titles": "Which job titles have you held? (Select up to 3)",
                    "certifications": "Do you have any relevant certifications or licenses? (E.g., Forklift, HACCP, etc.)",
                    "highest_education": "What is your highest level of education?",
                    "location": "What is your current city and state/province?"
                },
                "options": {
                    "key_skills": [
                        "Time Management", "Attention to Detail", "Teamwork", "Problem Solving",
                        "Customer Service", "Physical Stamina", "Communication", "Safety Focus"
                    ],
                    "job_titles": [
                        "Junior", "Senior", "Supervisor", "Assistant"
                    ],
                    "highest_education": [
                        "None", "Primary School", "High School/GED", "Vocational Training", "College Degree"
                    ]
                }
            };
            
            const localQuestionSets = {
                'cook': {
                    "questions": [
                        { "id": "name", "type": "text" },
                        { "id": "contact", "type": "text" },
                        { "id": "experience_years", "type": "text" },
                        { "id": "key_skills", "type": "multi-select", "options": ["Time Management", "Attention to Detail", "Teamwork", "Problem Solving", "Customer Service"] },
                        { "id": "highest_education", "type": "mcq", "options": ["None", "Primary School", "High School/GED", "Vocational Training", "College Degree"] },
                        { "id": "certifications", "type": "text" }
                    ]
                },
                'general': { // Fallback set
                    "questions": [
                        { "id": "name", "type": "text" },
                        { "id": "contact", "type": "text" },
                        { "id": "experience_years", "type": "text" },
                        { "id": "key_skills", "type": "multi-select", "options": ["Time Management", "Physical Stamina", "Teamwork", "Safety Focus"] },
                        { "id": "highest_education", "type": "mcq", "options": ["None", "Primary School", "High School/GED", "Vocational Training", "College Degree"] },
                        { "id": "location", "type": "text" }
                    ]
                }
                // Add more profession question sets here if needed, or they will fall back to 'general'
            };


            // --- State Variables ---
            let currentLang = 'en';
            let translations = localTranslations; // Use local data only
            let chatState = 'awaiting_profession'; 
            let currentQuestionSet = [];
            let currentQuestionIndex = 0;
            let resumeData = {}; 
            
            // --- DOM Elements ---
            const alertOverlay = document.getElementById('custom-alert-overlay');
            const alertMessage = document.getElementById('custom-alert-message');
            const alertCloseBtn = document.getElementById('custom-alert-close');
            const chatDisplay = document.getElementById('chat-display');
            const headerContent = document.getElementById('header-content');
            const createGoalBtn = document.getElementById('create-goal-btn');
            const sendBtn = document.querySelector('.send-btn');
            const goalInput = document.getElementById('goal-input');
            const langButton = document.getElementById('language-toggle-btn');
            const langDropdown = document.getElementById('language-dropdown-menu');
            const langButtonText = document.getElementById('current-lang-text');
            const langOptions = document.querySelectorAll('.language-option');
            const offlineModeBtn = document.getElementById('offline-mode-btn'); 
            // Re-added button references
            const ttsBtn = document.querySelector('#tts-btn'); 
            const micBtn = document.querySelector('#mic-btn');

            // Hardcoded professions list for display
            const professions = [
                { key: 'cook' }, { key: 'electrical' }, { key: 'plumbing' },
                { key: 'driver' }, { key: 'carpentry' }, { key: 'welding' },
                { key: 'masonry' }, { key: 'painting' }, { key: 'mechanic' },
                { key: 'factory' }, { key: 'farm' }, { key: 'security' },
                { key: 'cleaning' }, { key: 'tailor' }, { key: 'construction' },
                { key: 'automotive' }, { key: 'general' }
            ];

            // --- Initialization (Simplified: no loading necessary) ---
            (async () => {
                // Initial language setup (uses saved value but ignores actual loading)
                const initialLang = localStorage.getItem('appLang') || 'en';
                const initialLangOption = document.querySelector(`.language-option[data-lang="${initialLang}"]`);
                if(initialLangOption) {
                    langOptions.forEach(opt => opt.classList.remove('selected'));
                    initialLangOption.classList.add('selected');
                    const buttonText = initialLangOption.dataset.displayText || initialLangOption.textContent.split(' ')[0];
                    langButtonText.textContent = buttonText;
                    currentLang = 'en'; // Force to 'en' since we only have local English translations now
                    localStorage.setItem('appLang', 'en'); 
                }
                
                // Set initial disabled states for removed features
                if(ttsBtn) ttsBtn.disabled = true;
                if(micBtn) micBtn.disabled = true;
                
                applyTranslations();
            })();

            // --- Core Functions ---

            function applyTranslations() {
                // Note: Language switching is visually updated, but only English text is used.
                document.querySelectorAll('[data-translation-key]').forEach(element => {
                    const key = element.dataset.translationKey;
                    const translation = translations[key];
                    if (translation) {
                        const attr = element.dataset.translationAttr;
                        if (attr) {
                            element.setAttribute(attr, translation);
                        } else {
                            element.textContent = translation;
                        }
                    }
                });
                updatePlaceholder();
                
                // Enable button and set text directly
                if (createGoalBtn) {
                    createGoalBtn.disabled = false;
                    const btnText = document.getElementById('create-goal-btn-text');
                    if (btnText) {
                         btnText.textContent = translations['lets_make'] || "Start Building";
                         btnText.dataset.translationKey = 'lets_make'; 
                    }
                }
                
                // Re-translate current chat elements, including option buttons (Simplified)
                document.querySelectorAll('.option-btn').forEach(btn => {
                    let key = btn.dataset.key;
                    let text = "Error";
                    if (btn.classList.contains('profession-btn')) {
                        key = btn.dataset.key;
                        text = (translations.professions && translations.professions[key]) ? translations.professions[key] : key;
                    } else if (btn.classList.contains('done-btn')) {
                        text = translations['next'] || 'Next';
                    } else {
                        const qId = btn.dataset.questionId;
                        const index = btn.dataset.index;
                        if (qId && index !== undefined && translations.options && translations.options[qId] && translations.options[qId][index]) {
                            text = translations.options[qId][index];
                        } else {
                             // Fallback to key itself
                             text = key;
                        }
                    }
                    btn.textContent = text;
                    btn.dataset.text = text;
                });
            }
            
            function updatePlaceholder() {
                if (!translations) return; 
                if (goalInput.disabled) {
                    goalInput.placeholder = translations['select_profession'] || 'Please select an option...';
                } else {
                    goalInput.placeholder = translations['type_answer'] || 'Type your answer...';
                }
            }

            function addChatMessage(message, sender, options = {}) {
                if (!chatDisplay || message === undefined) {
                    console.error("Attempted to add undefined message or chatDisplay not found.");
                    return; 
                }; 
                const typingIndicator = chatDisplay.querySelector('.typing-indicator');
                if (typingIndicator) {
                    typingIndicator.remove();
                }
                const messageElement = document.createElement('div');
                messageElement.classList.add('chat-message');
                let textSpan;
                if (sender === 'bot') {
                    messageElement.classList.add('bot-message');
                    messageElement.innerHTML = `
                        <div class="bot-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M12 4c-4.418 0-8 3.582-8 8s3.582 8 8 8 8-3.582 8-8-3.582-8-8-8zM12 18c-3.314 0-6-2.686-6-6s2.686-6 6-6 6 2.686 6 6-2.686 6-6 6zM9 12c-0.552 0-1-0.448-1-1s0.448-1 1-1 1 0.448 1 1-0.448 1-1 1zM15 12c-0.552 0-1-0.448-1-1s0.448-1 1-1 1 0.448 1 1-0.448 1-1 1zM8 15h8v-1H8v1z"/></svg>
                        </div>
                        <span class="bot-message-text">${message}</span>
                    `;
                    textSpan = messageElement.querySelector('.bot-message-text');
                } else if (sender === 'typing') {
                    messageElement.classList.add('bot-message', 'typing-indicator');
                    messageElement.innerHTML = `
                        <div class="bot-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M12 4c-4.418 0-8 3.582-8 8s3.582 8 8 8 8-3.582 8-8-3.582-8-8-8zM12 18c-3.314 0-6-2.686-6-6s2.686-6 6-6 6 2.686 6 6-2.686 6-6 6zM9 12c-0.552 0-1-0.448-1-1s0.448-1 1-1 1 0.448 1 1-0.448 1-1 1zM15 12c-0.552 0-1-0.448-1-1s0.448-1 1-1 1 0.448 1 1-0.448 1-1 1zM8 15h8v-1H8v1z"/></svg>
                        </div>
                        <span class="bot-message-text">
                            <div class="dot"></div><div class="dot"></div><div class="dot"></div>
                        </span>
                    `;
                } else {
                    messageElement.classList.add('user-message');
                    messageElement.innerHTML = `
                        <span class="user-message-text">${message}</span>
                        <div class="user-icon">
                             <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 4 0 0 0-4-4H8a4 4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                        </div>
                    `;
                    textSpan = messageElement.querySelector('.user-message-text');
                }
                
                // Add keys for re-translation 
                if (textSpan) {
                    if (options.translationKey) {
                        textSpan.dataset.translationKey = options.translationKey;
                    }
                    if (options.professionText) {
                        textSpan.dataset.professionText = options.professionText;
                    }
                }
                
                chatDisplay.appendChild(messageElement);
                chatDisplay.scrollTop = chatDisplay.scrollHeight;
            }
            
            function showTypingAndReply(callback) {
                addChatMessage(null, 'typing');
                setTimeout(() => {
                    callback();
                }, 1200);
            }

            function displayProfessionOptions() {
                removeOptions(); 
                const optionsContainer = document.createElement('div');
                optionsContainer.className = 'options-container';
                professions.forEach(prof => {
                    const button = document.createElement('button');
                    button.className = 'option-btn profession-btn'; 
                    const text = (translations.professions && translations.professions[prof.key])
                                     ? translations.professions[prof.key]
                                     : prof.key;
                    button.textContent = text;
                    button.dataset.key = prof.key; 
                    button.dataset.text = text;
                    button.addEventListener('click', handleProfessionClick);
                    optionsContainer.appendChild(button);
                });
                chatDisplay.appendChild(optionsContainer);
                chatDisplay.scrollTop = chatDisplay.scrollHeight;
            }

            function handleProfessionClick(event) {
                const professionKey = event.target.dataset.key; 
                const professionText = event.target.dataset.text; 
                addChatMessage(professionText, 'user', { translationKey: `professions.${professionKey}` });
                removeOptions();
                showTypingAndReply(() => {
                    handleProfessionInput(professionKey, professionText);
                });
            }

            function displayOptions(questionId, optionKeys, type) {
                removeOptions(); 
                const optionsContainer = document.createElement('div');
                optionsContainer.className = 'options-container';
                optionsContainer.dataset.questionId = questionId;
                
                // Use the translated options from the local data structure
                const optionTranslations = translations.options[questionId] || optionKeys;
                
                optionKeys.forEach((key, index) => {
                    const button = document.createElement('button');
                    button.className = 'option-btn';
                    const translatedText = optionTranslations[index] || key;
                    
                    button.textContent = translatedText;
                    button.dataset.key = key; 
                    button.dataset.text = translatedText; 
                    button.dataset.type = type;
                    button.dataset.questionId = questionId;
                    button.dataset.index = index;
                    button.addEventListener('click', handleOptionClick);
                    optionsContainer.appendChild(button);
                });
                
                if (type === 'multi-select') {
                    const doneButton = document.createElement('button');
                    doneButton.className = 'option-btn done-btn';
                    doneButton.textContent = translations['next'] || 'Next';
                    doneButton.dataset.key = 'done';
                    doneButton.dataset.type = type;
                    doneButton.addEventListener('click', handleOptionClick);
                    optionsContainer.appendChild(doneButton);
                }
                chatDisplay.appendChild(optionsContainer);
                chatDisplay.scrollTop = chatDisplay.scrollHeight;
            }
            
            function handleOptionClick(event) {
                const clickedBtn = event.target;
                const type = clickedBtn.dataset.type;
                const key = clickedBtn.dataset.key;
                const text = clickedBtn.dataset.text;
                const question = currentQuestionSet[currentQuestionIndex];
                const questionId = question ? question.id : null; 
                const index = clickedBtn.dataset.index;

                if (type === 'mcq') {
                    if (!questionId) return; // safety check
                    resumeData[questionId] = key; 
                    addChatMessage(text, 'user', { translationKey: `options.${questionId}.${index}` }); 
                    removeOptions();
                    currentQuestionIndex++;
                    showTypingAndReply(askNextQuestion);
                } else if (type === 'multi-select') {
                    if (!questionId) return; // safety check
                    if (key === 'done') {
                        const selectedButtons = document.querySelectorAll('.option-btn.selected');
                        const selectedKeys = [];
                        const selectedTexts = [];
                        const selectedIndices = [];
                        selectedButtons.forEach(btn => {
                            selectedKeys.push(btn.dataset.key);
                            selectedTexts.push(btn.dataset.text);
                            selectedIndices.push(btn.dataset.index);
                        });
                        resumeData[questionId] = selectedKeys;
                        let joinedText;
                        let translationKey;
                        if (selectedTexts.length > 0) {
                            joinedText = selectedTexts.join(', ');
                            translationKey = JSON.stringify({ qId: questionId, indices: selectedIndices });
                        } else {
                            joinedText = translations['none'] || "None";
                            translationKey = 'none';
                        }
                        addChatMessage(joinedText, 'user', { translationKey: translationKey });
                        removeOptions();
                        currentQuestionIndex++;
                        showTypingAndReply(askNextQuestion);
                    } else {
                        clickedBtn.classList.toggle('selected');
                    }
                }
            }
            
            function removeOptions() {
                const existingOptions = chatDisplay.querySelector('.options-container');
                if (existingOptions) {
                    existingOptions.remove();
                }
            }

            // MODIFIED: This function now sends user input to the backend API if the chat is in the question phase.
            function handleUserInput() {
                if (goalInput.disabled) return;
                const inputText = goalInput.value.trim();
                if (!inputText) {
                    showCustomAlert(translations['alert_required'] || "Please type an answer to continue.");
                    return;
                }
                addChatMessage(inputText, 'user');
                goalInput.value = '';
                
                if (chatState === 'asking_questions') {
                    const question = currentQuestionSet[currentQuestionIndex];
                    if (question) {
                        resumeData[question.id] = inputText;
                        currentQuestionIndex++;
                    }
                    showTypingAndReply(askNextQuestion);
                }
            }

            // MODIFIED: Fetches questions from the backend API
            async function handleProfessionInput(professionKey, professionText) {
                let questionFileKey = professionKey;
                const API_PREFIX = "/backend/api/questions/";

                try {
                    const response = await fetch(API_PREFIX + professionKey);
                    if (!response.ok) {
                        console.warn(`File not found for ${professionKey}, using general.`);
                        questionFileKey = 'general';
                        const generalResponse = await fetch(API_PREFIX + 'general');
                        if (!generalResponse.ok) throw new Error("General question file not found.");
                        const data = await generalResponse.json();
                        currentQuestionSet = data.questions;
                    } else {
                        const data = await response.json();
                        currentQuestionSet = data.questions;
                    }
                } catch (e) {
                    console.error('Error fetching question set:', e);
                    const errorMsg = translations['question_fetch_fail'] || "Could not load questions. Please refresh and try again.";
                    showCustomAlert(errorMsg);
                    return;
                }

                chatState = 'asking_questions'; 
                currentQuestionIndex = 0;
                resumeData = { 'profession': questionFileKey }; 
                const ackMsg = (translations['profession_selected'] || 'Great! {profession}.')
                                             .replace('{profession}', professionText);
                addChatMessage(ackMsg, 'bot', { 
                    translationKey: 'profession_selected', 
                    professionText: professionText 
                });
                setTimeout(askNextQuestion, 800);
            }

            function askNextQuestion() {
                removeOptions(); 

                if (currentQuestionIndex < currentQuestionSet.length) {
                    const question = currentQuestionSet[currentQuestionIndex];
                    const questionText = (translations.questions && translations.questions[question.id])
                                                 ? translations.questions[question.id]
                                                 : (question.question || `Missing question for ${question.id}`);
                    
                    addChatMessage(questionText, 'bot', { translationKey: `questions.${question.id}` });
                    
                    if (question.type === 'text' || question.type === 'tel' || question.type === 'email' || question.id === 'certifications' || question.id === 'location') {
                        goalInput.disabled = false;
                        sendBtn.disabled = false;
                        goalInput.placeholder = translations['type_answer'] || 'Type your answer...';
                        goalInput.focus();
                    } else if (question.type === 'mcq' || question.type === 'multi-select') {
                        goalInput.disabled = true;
                        sendBtn.disabled = true;
                        goalInput.placeholder = translations['select_profession'] || 'Please select an option...';
                        
                        const optionKeys = question.options;
                        displayOptions(question.id, optionKeys, question.type); 
                    }

                } else {
                    chatState = 'completed'; 
                    processCompletedResumeData(); 
                }
            }
            
            // MODIFIED: Sends data to the /backend/api/generate-resume API
            async function processCompletedResumeData() {
                goalInput.disabled = true;
                sendBtn.disabled = true;
                goalInput.placeholder = translations['type_answer'] || 'Processing...';

                const processingMsg = translations['resume_complete'] || 'All questions answered. Processing your data for resume generation...';
                addChatMessage(processingMsg, 'bot', { translationKey: 'resume_complete' });

                console.log('--- FINAL RESUME DATA SENT TO API ---', resumeData);

                try {
                    const response = await fetch('/backend/api/generate-resume', { 
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Language-Code': currentLang // Send language code for AI output translation
                        },
                        body: JSON.stringify(resumeData)
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    
                    const successMsg = translations['resume_success'] || 'Success! Your resume is ready. Redirecting to your dashboard...';
                    addChatMessage(successMsg, 'bot', { translationKey: 'resume_success' });
                    
                    setTimeout(() => {
                        // Use the resume_id returned by the backend
                        window.location.href = `/dashboard.html?resume_id=${result.resume_id || 'temp'}`;
                    }, 2000);

                } catch (error) {
                    console.error('API Error during resume generation:', error);
                    const errorMsg = translations['resume_fail'] || 'Generation failed! Please try again or check your network connection.';
                    addChatMessage(errorMsg, 'bot', { translationKey: 'resume_fail' });
                    // Re-enable input/send for manual retries or debugging if needed, but not necessary here
                }
            }
            
            function showCustomAlert(message) {
                if (alertMessage) alertMessage.textContent = message;
                if (alertOverlay) alertOverlay.style.display = 'flex';
                if (alertCloseBtn) alertCloseBtn.textContent = translations['next'] || 'OK';
            }
            
            if (alertCloseBtn) {
                alertCloseBtn.addEventListener('click', () => {
                    if (alertOverlay) alertOverlay.style.display = 'none';
                });
            }
            if (alertOverlay) {
                alertOverlay.addEventListener('click', (event) => {
                    if (event.target === alertOverlay) {
                        alertOverlay.style.display = 'none';
                    }
                });
            }

            // Removed functions for TTS and Speech Recognition (TTS/MIC functionality removed)
            
            function showOfflineAlert() {
                showCustomAlert(translations['alert_switch_offline'] || "This is the manual builder. All AI features are already disabled.");
            }

            // --- Event Listeners ---

            if (createGoalBtn) {
                createGoalBtn.addEventListener('click', () => {
                    if (headerContent) headerContent.classList.add('hidden');
                    if (chatDisplay) chatDisplay.classList.add('visible');
                    goalInput.disabled = true; 
                    sendBtn.disabled = true;
                    // Keep TTS/MIC disabled as their functionality is removed
                    if(ttsBtn) ttsBtn.disabled = true;
                    if(micBtn) micBtn.disabled = true;

                    updatePlaceholder();
                    
                    const welcomeMsg = translations['welcome_message'] || "Hello! I'm your resume assistant.";
                    addChatMessage(welcomeMsg, 'bot', { translationKey: 'welcome_message' });

                    setTimeout(() => {
                        const askProfMsg = translations['select_profession_prompt'] || "To start, please choose your profession from the list below."; 
                        addChatMessage(askProfMsg, 'bot', { translationKey: 'select_profession_prompt' });
                        displayProfessionOptions(); 
                    }, 1000);
                });
            }
            
            if (sendBtn) {
                sendBtn.addEventListener('click', handleUserInput);
            }
            
            if (goalInput) {
                goalInput.addEventListener('keypress', (event) => {
                    if (event.key === 'Enter' && !sendBtn.disabled) {
                        handleUserInput(); 
                    }
                });
            }
            
            // TTS/MIC event listeners remain only to show an alert that the feature is disabled
            if (ttsBtn) {
                ttsBtn.addEventListener('click', () => {
                     showCustomAlert("Text-to-Speech is currently disabled (AI/Browser API removed).");
                });
            }
            if (micBtn) {
                micBtn.addEventListener('click', () => {
                     showCustomAlert("Voice input is currently disabled (AI/Browser API removed).");
                });
            }

            // Language Switcher (Modified to use API but is locally set to 'en' in the logic)
            if (langButton && langDropdown) {
                langButton.addEventListener('click', (event) => {
                    event.stopPropagation(); 
                    langDropdown.classList.toggle('show');
                    langButton.setAttribute('aria-expanded', langDropdown.classList.contains('show'));
                });

                window.addEventListener('click', (event) => {
                    if (langDropdown.classList.contains('show') && !langButton.contains(event.target) && !langDropdown.contains(event.target)) {
                        langDropdown.classList.remove('show');
                        langButton.setAttribute('aria-expanded', 'false');
                    }
                });

                langOptions.forEach(option => {
                    option.addEventListener('click', async function(event) {
                        event.preventDefault(); 
                        
                        const selectedLanguageText = this.dataset.displayText || this.textContent.split(' ')[0];
                        const buttonText = selectedLanguageText.split(' ')[0];
                        const newLangCode = this.dataset.lang;
                        
                        if (langButtonText) langButtonText.textContent = buttonText;

                        langOptions.forEach(opt => opt.classList.remove('selected'));
                        this.classList.add('selected');
                        
                        langDropdown.classList.remove('show');
                        langButton.setAttribute('aria-expanded', 'false');

                        if (newLangCode !== currentLang) {
                            // --- Re-integrate API Call for Translations ---
                            try {
                                const response = await fetch(`/backend/api/translations/${newLangCode}`); 
                                if (!response.ok) {
                                     // Fallback to English but show a warning
                                    console.warn(`Failed to load translations for ${newLangCode}. Using English fallback.`);
                                    const fallbackResponse = await fetch(`/backend/api/translations/en`);
                                    if (!fallbackResponse.ok) throw new Error("English fallback also failed.");
                                    translations = await fallbackResponse.json();
                                    currentLang = 'en'; 
                                } else {
                                    translations = await response.json();
                                    currentLang = newLangCode; 
                                }
                                localStorage.setItem('appLang', currentLang);
                                applyTranslations(); // Apply new translations
                                showCustomAlert(`${translations['alert_lang_change'] || 'Language set to'} ${selectedLanguageText}`);

                            } catch (error) {
                                console.error('CRITICAL ERROR: Could not load translations from server:', error);
                                showCustomAlert(localTranslations['question_fetch_fail'] || 'CRITICAL ERROR: Could not load translations from server. Check network and backend.');
                                return;
                            }
                        }
                    });
                });
            }
            
            if (offlineModeBtn) {
                offlineModeBtn.addEventListener('click', showOfflineAlert);
            }
        });
    </script>
</body>
</html>